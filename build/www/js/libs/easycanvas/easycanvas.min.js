/*!
 * VERSION: 0.1.0
 * DATE: 2015-08-25
 * GIT:https://github.com/shrekshrek/easycanvas
 *
 * @author: Shrek.wang, shrekshrek@gmail.com
 **/

!function(t){var i="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"function"==typeof define&&define.amd?define(["exports"],function(e){i.EC=t(i,e)}):"undefined"!=typeof exports?t(i,exports):i.EC=t(i,{})}(function(t,i){var e=t.EC;i.VERSION="0.1.0",i.noConflict=function(){return t.EC=e,this};var s=function(t){var i=[];for(var e in t)i.push(e);return i},n=function(t){var i=arguments.length;if(2>i||null==t)return t;for(var e=1;i>e;e++)for(var n=arguments[e],h=s(n),o=h.length,r=0;o>r;r++){var a=h[r];t[a]=n[a]}return t},h=function(t,i){var e,s=this;e=t&&Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(){return s.apply(this,arguments)},n(e,s,i);var h=function(){this.constructor=e};return h.prototype=s.prototype,e.prototype=new h,t&&n(e.prototype,t),e.__super__=s.prototype,e};i.STROKE_CAPS_MAP=["butt","round","square"],i.STROKE_JOINTS_MAP=["miter","round","bevel"],i.TEXT_ALIGN_MAP=["center","end","left","right","start"],i.TEXT_BASELINE_MAP=["alphabetic","top","hanging","middle","ideographic","bottom"],i.Object=function(){this.initialize.apply(this,arguments)},n(i.Object.prototype,{x:0,y:0,position:function(t,i){switch(arguments.length){case 1:return this.x=t,this.y=t,this;case 2:return this.x=t,this.y=i,this}return this},move:function(t,i){switch(arguments.length){case 1:return this.x+=t,this.y+=t,this;case 2:return this.x+=t,this.y+=i,this}return this},rotation:0,rotate:function(t){switch(arguments.length){case 1:return this.rotation+=t,this}return this},scaleX:0,scaleY:0,scale:function(t,i){switch(arguments.length){case 1:return this.scaleX=t,this.scaleY=t,this;case 2:return this.scaleX=t,this.scaleY=i,this}return this},width:0,height:0,size:function(t,i){switch(arguments.length){case 1:return this.width=t,this.height=t,this;case 2:return this.width=t,this.height=i,this}return this},initialize:function(){this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.width=0,this.height=0,this.children=[]},destroy:function(){for(var t=this.children.length-1;t>=0;t--)this.children[t].destroy();this.children=[]},parent:null,children:null,index:null,addChild:function(t){t.parent&&t.parent.removeChild(t);var i=this.children.length;return t.parent=this,t.index=i,this.children[i]=t,this},addChildAt:function(t,i){t.parent&&t.parent.removeChild(t);var e=this.children.length,s=Math.max(0,Math.min(e-1,i));this.children.splice(s,0,t),t.parent=this;for(var n=e-1;n>=0;n--)this.children[n].index=n;return this},removeChild:function(t){if(t.parent===this){this.children.splice(t.index,1),t.parent=null,t.index=null;for(var i=this.children.length,e=i-1;e>=0;e--)this.children[e].index=e;return this}}}),i.Object.extend=h,i.Sprite=i.Object.extend({update:function(t){t&&(t.save(),this.transform(t),this.childUpdate(t),t.restore())},transform:function(t){t.translate(this.x,this.y),t.rotate(this.rotation*Math.PI/180),t.scale(this.scaleX,this.scaleY)},childUpdate:function(t){for(var i=this.children.length,e=0;i>e;e++){var s=this.children[e];s.update(t)}}}),i.Stage=i.Sprite.extend({el:null,ctx:null,initialize:function(t){i.Stage.__super__.initialize.apply(this,[t]);var e;e=t&&t.el?t.el:document.createElement("canvas"),this.ctx=e.getContext("2d"),this.el=e,e.le=this},update:function(){return this.ctx.clearRect(0,0,this.el.width,this.el.height),this.ctx.save(),this.childUpdate(this.ctx),this.ctx.restore(),this}}),i.Bitmap=i.Sprite.extend({image:null,initialize:function(t){i.Stage.__super__.initialize.apply(this,[t]),t&&t.image&&(this.image=t.image),this.originX=.5,this.originY=.5},update:function(t){t&&(t.save(),this.transform(t),t.drawImage(this.image,-this.image.width*this.originX,-this.image.height*this.originY,this.image.width,this.image.height),this.childUpdate(t),t.restore())},originX:0,originY:0,origin:function(t,i){switch(arguments.length){case 1:return this.originX=Math.max(0,Math.min(1,t)),this.originY=Math.max(0,Math.min(1,t)),this;case 2:return this.originX=Math.max(0,Math.min(1,t)),this.originY=Math.max(0,Math.min(1,i)),this}return this}}),i.Graphic=i.Sprite.extend({actions:[],initialize:function(t){i.Graphic.__super__.initialize.apply(this,[t]),this.actions=[]},update:function(t){t&&(t.save(),this.transform(t),this.updateG(t),this.childUpdate(t),t.restore())},updateG:function(t){for(var i=this.actions.length,e=0;i>e;e++)this.actions[e].update(t)},clear:function(){this.actions=[]},fill:function(t){this.actions.push(new o.fill(t))},strokeStyle:function(t,i,e,s,n){this.actions.push(new o.strokeStyle(t,i,e,s,n))},stroke:function(t){this.actions.push(new o.stroke(t))},moveTo:function(t,i){this.actions.push(new o.moveTo(t,i))},lineTo:function(t,i){this.actions.push(new o.lineTo(t,i))},arcTo:function(t,i,e,s,n){this.actions.push(new o.arcTo(t,i,e,s,n))},arc:function(t,i,e,s,n,h){this.actions.push(new o.arc(t,i,e,s,n,h))},quadraticCurveTo:function(t,i,e,s){this.actions.push(new o.quadraticCurveTo(t,i,e,s))},bezierCurveTo:function(t,i,e,s,n,h){this.actions.push(new o.bezierCurveTo(t,i,e,s,n,h))},rect:function(t,i,e,s){this.actions.push(new o.rect(t,i,e,s))},closePath:function(){this.actions.push(new o.closePath)},beginPath:function(){this.actions.push(new o.beginPath)},circle:function(t,i,e){this.actions.push(new o.circle(t,i,e))},ellipse:function(t,i,e,s){this.actions.push(new o.ellipse(t,i,e,s))}}),i.Text=i.Sprite.extend({actions:[],initialize:function(t){i.Text.__super__.initialize.apply(this,[t]),this.actions=[]},update:function(t){t&&(t.save(),this.transform(t),this.updateG(t),this.childUpdate(t),t.restore())},updateG:function(t){for(var i=this.actions.length,e=0;i>e;e++)this.actions[e].update(t)},clear:function(){this.actions=[]},fontStyle:function(t,i,e){this.actions.push(new o.fontStyle(t,i,e))},fillText:function(t,i,e,s){this.actions.push(new o.fillText(t,i,e,s))},strokeText:function(t,i,e,s){this.actions.push(new o.strokeText(t,i,e,s))}});var o={};return(o.fill=function(t){this.style=t}).prototype.update=function(t){t.fillStyle=this.style,t.fill()},(o.strokeStyle=function(t,i,e,s,n){this.width=t,this.caps=i,this.joints=e,this.miterLimit=s,this.ignoreScale=n}).prototype.update=function(t){t.lineWidth=null==this.width?"1":this.width,t.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:i.STROKE_CAPS_MAP[this.caps],t.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:i.STROKE_JOINTS_MAP[this.joints],t.miterLimit=null==this.miterLimit?"10":this.miterLimit,t.ignoreScale=null==this.ignoreScale?!1:this.ignoreScale},(o.stroke=function(t){this.style=t}).prototype.update=function(t){t.strokeStyle=this.style,t.stroke()},(o.moveTo=function(t,i){this.x=t,this.y=i}).prototype.update=function(t){t.moveTo(this.x,this.y)},(o.lineTo=function(t,i){this.x=t,this.y=i}).prototype.update=function(t){t.lineTo(this.x,this.y)},(o.arcTo=function(t,i,e,s,n){this.x1=t,this.y1=i,this.x2=e,this.y2=s,this.radius=n}).prototype.update=function(t){t.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},(o.arc=function(t,i,e,s,n,h){this.x=t,this.y=i,this.radius=e,this.startAngle=s,this.endAngle=n,this.anticlockwise=!!h}).prototype.update=function(t){t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},(o.quadraticCurveTo=function(t,i,e,s){this.cpx=t,this.cpy=i,this.x=e,this.y=s}).prototype.update=function(t){t.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},(o.bezierCurveTo=function(t,i,e,s,n,h){this.cp1x=t,this.cp1y=i,this.cp2x=e,this.cp2y=s,this.x=n,this.y=h}).prototype.update=function(t){t.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},(o.rect=function(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}).prototype.update=function(t){t.rect(this.x,this.y,this.w,this.h)},(o.closePath=function(){}).prototype.update=function(t){t.closePath()},(o.beginPath=function(){}).prototype.update=function(t){t.beginPath()},(o.circle=function(t,i,e){this.x=t,this.y=i,this.radius=e}).prototype.update=function(t){t.arc(this.x,this.y,this.radius,0,2*Math.PI)},(o.ellipse=function(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}).prototype.update=function(t){var i=this.x,e=this.y,s=this.w,n=this.h,h=.5522848,o=s/2*h,r=n/2*h,a=i+s,c=e+n,u=i+s/2,l=e+n/2;t.moveTo(i,l),t.bezierCurveTo(i,l-r,u-o,e,u,e),t.bezierCurveTo(u+o,e,a,l-r,a,l),t.bezierCurveTo(a,l+r,u+o,c,u,c),t.bezierCurveTo(u-o,c,i,l+r,i,l)},(o.fontStyle=function(t,i,e){this.font=t,this.textAlign=i,this.textBaseline=e}).prototype.update=function(t){t.font=null==this.font?"1":this.font,t.textAlign=null==this.textAlign?"start":isNaN(this.textAlign)?this.textAlign:i.TEXT_ALIGN_MAP[this.textAlign],t.textBaseline=null==this.textBaseline?"alphabetic":isNaN(this.textBaseline)?this.textBaseline:i.TEXT_BASELINE_MAP[this.textBaseline]},(o.fillText=function(t,i,e,s){this.text=t,this.x=i,this.y=e,this.maxWidth=s}).prototype.update=function(t){t.fillText(this.text,this.x,this.y,this.maxWidth)},(o.strokeText=function(t,i,e,s){this.text=t,this.x=i,this.y=e,this.maxWidth=s}).prototype.update=function(t){t.strokeText(this.text,this.x,this.y,this.maxWidth)},i});
