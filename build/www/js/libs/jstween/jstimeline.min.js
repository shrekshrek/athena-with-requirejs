/*!
 * VERSION: 0.9.0
 * DATE: 2017-9-3
 * GIT: https://github.com/shrekshrek/jstween
 * @author: Shrek.wang
 **/

!function(e){if("function"==typeof define&&define.amd)define(["jstween","exports"],function(t,i){window.JTL=e(i,t)});else if("undefined"!=typeof exports){var t=require("jstween");e(exports,t)}else window.JTL=e({},window.JT)}(function(e,t){function i(e){var t=/(^[a-zA-Z]\w*|)(\+=|-=|)(\d*\.\d*|\d*)/,i=t.exec(e);return{label:i[1],ext:i[2],num:parseFloat(i[3])}}function s(){var e=h.length;if(0===e)return void(o=!1);var i=t.now(),n=i-m;m=i,r=h.slice(0);for(var u=0;e>u;u++){var p=r[u];p&&p.isPlaying&&!p._update(n)&&p.pause()}a(s)}function n(){this.initialize.apply(this,arguments)}var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},h=[],r=[],o=!1,m=0;return Object.assign(n.prototype,{initialize:function(e){e=e||{},this.duration=0,this.delay=1e3*Math.max(e.delay||0,0),this.yoyo=e.yoyo||!1,this.repeat=e.repeat?e.repeat<0?-100:e.repeat:0,this.repeatDelay=1e3*Math.max(e.repeatDelay||0,0),this.onStart=e.onStart||null,this.onStartScope=e.onStartScope||this,this.onStartParams=e.onStartParams||[],this.onRepeat=e.onRepeat||null,this.onRepeatScope=e.onRepeatScope||this,this.onRepeatParams=e.onRepeatParams||[],this.onEnd=e.onEnd||null,this.onEndScope=e.onEndScope||this,this.onEndParams=e.onEndParams||[],this.onUpdate=e.onUpdate||null,this.onUpdateScope=e.onUpdateScope||this,this.onUpdateParams=e.onUpdateParams||[],this.isPlaying=!1,this.isReverse=e.isReverse||!1,this.timeScale=e.timeScale||1,this.isKeep=!1,this.isYoReverse=!1,this.startTime=this.delay,this._updateEndTime(),this.curTime=this.prevTime=0,this.labels=[],this.tweens=[],this.calls=[]},_updateEndTime:function(){this.endTime=this.repeat<0?999999999999:this.startTime+this.repeatDelay*this.repeat+this.duration*(this.repeat+1)},_update:function(e){if(this.isKeep=!1,e=this.isReverse?-e*this.timeScale:e*this.timeScale,this.prevTime=this.curTime,this.curTime=this.prevTime+e,this.onUpdate&&this.onUpdate.apply(this.onUpdateScope,this.onUpdateParams),this.isReverse&&this.prevTime>=0&&this.curTime<0)return this.curTime=0,this._updateProp(),this.onStart&&this.prevTime>=this.startTime&&this.onStart.apply(this.onStartScope,this.onStartParams),this.isKeep;if(!this.isReverse&&this.prevTime<this.endTime&&this.curTime>=this.endTime)return this.curTime=this.endTime,this._updateProp(),this.onEnd&&this.onEnd.apply(this.onEndScope,this.onEndParams),this.isKeep;var t=this.repeat<0?999999999999:this.repeat,i=Math.min(t,Math.max(0,Math.floor((this.prevTime-this.startTime)/(this.duration+this.repeatDelay)))),s=Math.min(t,Math.max(0,Math.floor((this.curTime-this.startTime)/(this.duration+this.repeatDelay))));return i!=s&&(this.yoyo&&(this.isYoReverse=!this.isYoReverse),this.onRepeat&&this.onRepeat.apply(this.onRepeatScope,this.onRepeatParams)),this._updateProp(),this.onEnd&&this.isReverse&&this.prevTime==this.endTime&&this.curTime<this.endTime&&this.onEnd.apply(this.onEndScope,this.onEndParams),this.onStart&&(this.isReverse?this.prevTime>=this.startTime&&this.curTime<this.startTime:0==this.startTime&&0==this.prevTime&&this.curTime>=this.startTime||this.prevTime<this.startTime&&this.curTime>=this.startTime)&&this.onStart.apply(this.onStartScope,this.onStartParams),!0},_updateProp:function(){var e=this.prevTime==this.endTime?this.duration:(this.prevTime-this.startTime)%(this.duration+this.repeatDelay),t=this.curTime==this.endTime?this.duration:(this.curTime-this.startTime)%(this.duration+this.repeatDelay);this._checkCall(e,t),this._checkTween(e,t)},_addSelf:function(){h.push(this),o||(m=t.now(),o=!0,a(s))},_removeSelf:function(){var e=h.indexOf(this);-1!==e&&h.splice(e,1)},_parsePosition:function(e){if(void 0==e)return this.duration;var t=i(e),s=0;if(t.label)s=this.getLabelTime(t.label);else if(t.ext){switch(t.ext){case"+=":s=this.duration+1e3*t.num;break;case"-=":s=this.duration-1e3*t.num}this._updateEndTime()}else t.num&&(s=1e3*t.num);return s},_addCall:function(e,t){var i=this._parsePosition(t);this.duration=Math.max(this.duration,i),this.calls.push({time:i,call:e}),this._updateEndTime()},_checkCall:function(e,t){for(var i=0,s=this.calls.length;s>i;i++){var n=this.calls[i],a=n.time;(this.isReverse?e>=a&&a>t:0==a&&0==e&&t>=a||a>e&&t>=a)&&n.call()}},_addTween:function(e,t){var i=this._parsePosition(t);this.duration=Math.max(this.duration,i+e.endTime),this.tweens.push({time:i,tween:e}),this._updateEndTime()},_checkTween:function(e,t){for(var i=0,s=this.tweens.length;s>i;i++){var n=this.tweens[i],a=n.time,h=n.time+n.tween.endTime;(t>=a&&h>=t||e>a&&h>e)&&(e>=a&&a>t?n.tween._update(e-a):e>h&&h>=t?(n.tween.curTime=n.tween.prevTime=n.tween.endTime,n.tween._update(h-t)):a>e&&t>=a?(n.tween.curTime=n.tween.prevTime=0,n.tween._update(t-a)):n.tween._update(h>=e&&t>h?h-e:Math.abs(t-e)))}},fromTo:function(e,i,s,n,a){n.isPlaying=!1;var h=t.fromTo(e,i,s,n);return this._addTween(h,a),this},from:function(e,i,s,n){s.isPlaying=!1;var a=t.from(e,i,s);return this._addTween(a,n),this},to:function(e,i,s,n){s.isPlaying=!1;var a=t.to(e,i,s);return this._addTween(a,n),this},add:function(e,t){switch(typeof e){case"object":this._addTween(e,t);break;case"function":this._addCall(e,t);break;case"string":this.addLabel(e,t);break;default:throw"add action is wrong!!!"}return this},remove:function(e){for(var t=this._parsePosition(e),i=this.calls.length,s=i-1;s>=0;s--){var n=this.calls[s];n.time==t&&this.calls.splice(s,1)}for(var i=this.tweens.length,s=i-1;s>=0;s--){var a=this.tweens[s];a.time==t&&this.tweens.splice(s,1)}return this},addLabel:function(e,t){this.removeLabel(e);var i=this._parsePosition(t);this.labels.push({name:e,time:i})},removeLabel:function(e){for(var t=0,i=this.labels.length;i>t;t++){var s=this.labels[t];if(e==s.name)return void this.labels.splice(t,1)}},getLabelTime:function(e){for(var t=0,i=this.labels.length;i>t;t++){var s=this.labels[t];if(e==s.name)return s.time}return null},totalTime:function(){return this.duration},play:function(e){this.isKeep=!0,this.isReverse=!1;for(var t in this.tweens)this.tweens[t].tween.isReverse=this.isReverse;void 0!==e&&this.seek(e),this.isPlaying||(this.isPlaying=!0,this._addSelf())},pause:function(){this.isKeep=!1,this.isPlaying&&(this.isPlaying=!1,this._removeSelf())},stop:function(){this.pause(),this.curTime=this.prevTime=0},reverse:function(e){this.isKeep=!0,this.isReverse=!0;for(var t in this.tweens)this.tweens[t].tween.isReverse=this.isReverse;void 0!==e&&this.seek(e),this.isPlaying||(this.isPlaying=!0,this._addSelf())},seek:function(e){var t=Math.max(0,Math.min(this.duration,this._parsePosition(e)));if(this.curTime!=t){this.curTime=t;for(var i=0,s=this.tweens.length;s>i;i++){var n=this.tweens[i],a=n.time,h=n.time+n.tween.endTime;n.tween.seek(this.curTime<a?0:this.curTime>h?n.tween.endTime:(this.curTime-a)/1e3)}}},kill:function(){this.pause(),this.tweens=[],this.calls=[],this.labels=[],this.duration=0,this.curTime=this.prevTime=this.startTime=this.endTime=0,this.onStart=this.onRepeat=this.onEnd=this.onUpdate=null}}),Object.assign(e,{create:function(e){return new n(e)},kill:function(e){e.kill()}}),e});
