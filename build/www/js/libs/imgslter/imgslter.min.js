/*!
 * GIT: https://github.com/shrekshrek/image-selecter
 **/

!function(e,t){if("object"==typeof exports&&"undefined"!=typeof module){var i=require("exif");module.exports=t(i)}else"function"==typeof define&&define.amd?define(["exif"],t):e.ImgSlter=t(e.EXIF)}(this,function(e){"use strict";var t=function(){var e=navigator.userAgent;return{ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),iosv:e.substr(e.indexOf("iPhone OS")+9,3)}}(),i=function(){this.initialize.apply(this,arguments)};return i.prototype={initialize:function(e){var t=e||{};this.el=t.el||function(){var e=document.createElement("INPUT");return e.type="file",e.accept="image/*",e.multiple=!1,e}(),this.size=t.size||500,this.type=t.type||"jpeg",this.quality=t.quality||.7,this.handler=t.handler||function(){},this.color=t.color,this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),this._changeHandler=this._changeHandler.bind(this),this.el.addEventListener("change",this._changeHandler,!1)},_changeHandler:function(i){var n=this,a=i.target.files[0];if(void 0!=a){var c,s,r,o,h,l;window.URL=window.URL||window.webkitURL;var d=window.URL.createObjectURL(a),f=new Image;f.src=d,f.onload=function(){e.getData(f,function(){var i=e.getTag(this,"Orientation")||0;c=f.width,o=f.height,c>=o?(s=n.size,h=s*o/c,r=c,l=o):(h=n.size,s=h*c/o,r=o,l=c);var d,u,g;switch(i){case 3:d=s,u=h,g=180;break;case 6:d=h,u=s,g=90;break;case 8:d=h,u=s,g=270;break;default:d=s,u=h,g=0}n.cvs.width=d,n.cvs.height=u,n.ctx.clearRect(0,0,d,u),n.color&&(n.ctx.fillStyle=n.color,n.ctx.fillRect(0,0,d,u)),n.ctx.translate(d/2,u/2),n.ctx.rotate(g*Math.PI/180),3260<r||l>2440?t.ios?parseInt(t.iosv)>=8?n.ctx.drawImage(f,0,0,c,o,-s/2,-h/2,s,h):n.ctx.drawImage(f,0,0,c/2,o/2,-s/2,-h/2,s,h):n.ctx.drawImage(f,0,0,c,o,-s/2,-h/2,s,h):n.ctx.drawImage(f,-s/2,-h/2,s,h),n.handler.call(this,{img:n.cvs.toDataURL("image/"+n.type,n.quality),width:n.cvs.width,height:n.cvs.height}),window.URL.revokeObjectURL(a)})}}},select:function(){this.el&&this.el.click()},destroy:function(){this.el.removeEventListener("change",this._changeHandler,!1),delete this.ctx,delete this.cvs,delete this.el}},i});
